# EasyConnect ä»£ç æ¶æ„æ–‡æ¡£

## ç›®å½•ç»“æ„

```
EasyConnect/
â”œâ”€â”€ main.py              # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ config.py            # é…ç½®æ–‡ä»¶
â”œâ”€â”€ network/             # ç½‘ç»œæ¨¡å—
â”‚   â”œâ”€â”€ discovery.py     # è®¾å¤‡å‘ç° (mDNS)
â”‚   â””â”€â”€ transfer.py      # æ•°æ®ä¼ è¾“ (TCP)
â”œâ”€â”€ ui/                  # ç•Œé¢æ¨¡å—
â”‚   â”œâ”€â”€ main_window.py   # ä¸»çª—å£
â”‚   â”œâ”€â”€ send_panel.py    # æ‚¬æµ®å‘é€é¢æ¿
â”‚   â””â”€â”€ receive_bubble.py# æ¥æ”¶æ°”æ³¡é€šçŸ¥
â”œâ”€â”€ utils/               # å·¥å…·æ¨¡å—
â”‚   â””â”€â”€ clipboard.py     # å‰ªè´´æ¿ç®¡ç†
â””â”€â”€ android-kotlin/      # Android åŸç”Ÿç‰ˆæœ¬
```

---

## æ¡Œé¢ç‰ˆ (Python + PySide6)

### 1. config.py - é…ç½®æ¨¡å—

**åŠŸèƒ½**: å®šä¹‰å…¨å±€é…ç½®å¸¸é‡å’Œå·¥å…·å‡½æ•°

| é…ç½®é¡¹ | å€¼ | è¯´æ˜ |
|--------|-----|------|
| `SERVICE_TYPE` | `_easyconnect._tcp.local.` | mDNS æœåŠ¡ç±»å‹ |
| `TRANSFER_PORT` | `52525` | TCP ä¼ è¾“ç«¯å£ |
| `BUFFER_SIZE` | `8192` | ä¼ è¾“ç¼“å†²åŒºå¤§å° |
| `RECEIVE_DIR` | `~/EasyConnect_Received` | æ–‡ä»¶ä¿å­˜ç›®å½• |

**æ ¸å¿ƒå‡½æ•°**:
- `get_device_name()` - è·å–è®¾å¤‡å (ä¸»æœºå + ç³»ç»Ÿç±»å‹)
- `get_local_ip()` - é€šè¿‡ UDP è¿æ¥è·å–æœ¬æœº IP

---

### 2. network/discovery.py - è®¾å¤‡å‘ç°æ¨¡å—

**åŠŸèƒ½**: ä½¿ç”¨ zeroconf åº“å®ç° mDNS è®¾å¤‡è‡ªåŠ¨å‘ç°

**ç±»ç»“æ„**:

| ç±» | èŒè´£ |
|----|------|
| `Device` | è®¾å¤‡æ•°æ®ç±» (name, ip, port) |
| `DeviceListener` | mDNS æœåŠ¡ç›‘å¬å™¨ |
| `DeviceDiscovery` | è®¾å¤‡å‘ç°ç®¡ç†å™¨ |

**DeviceDiscovery å·¥ä½œæµç¨‹**:
```
start()
  â”œâ”€â”€ åˆå§‹åŒ– Zeroconf(interfaces=['0.0.0.0'])
  â”œâ”€â”€ _register_service()  # æ³¨å†Œæœ¬æœºæœåŠ¡
  â”‚     â””â”€â”€ ServiceInfo â†’ zeroconf.register_service()
  â””â”€â”€ ServiceBrowser()     # å¼€å§‹ç›‘å¬å…¶ä»–è®¾å¤‡
        â”œâ”€â”€ add_service    â†’ _on_device_add()
        â”œâ”€â”€ remove_service â†’ _on_device_remove()
        â””â”€â”€ update_service â†’ add_service()
```

---

### 3. network/transfer.py - æ•°æ®ä¼ è¾“æ¨¡å—

**åŠŸèƒ½**: TCP Socket å®ç°æ–‡ä»¶å’Œæ–‡å­—çš„å‘é€ä¸æ¥æ”¶

**æ¶ˆæ¯åè®®**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4å­—èŠ‚é•¿åº¦å¤´ (å¤§ç«¯åº) â”‚ JSON æ¶ˆæ¯ä½“        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**JSON æ ¼å¼**:
```json
// æ–‡å­—æ¶ˆæ¯
{"type": "TEXT", "sender": "è®¾å¤‡å", "content": "æ–‡å­—å†…å®¹"}

// æ–‡ä»¶æ¶ˆæ¯
{"type": "FILE", "sender": "è®¾å¤‡å", "content": "æ–‡ä»¶å", "file_size": 12345}
```

**ç±»ç»“æ„**:

| ç±» | èŒè´£ |
|----|------|
| `FileTransfer` | å‘é€å®¢æˆ·ç«¯ |
| `TransferServer` | æ¥æ”¶æœåŠ¡å™¨ |

**æ–‡ä»¶ä¼ è¾“æµç¨‹**:
```
å‘é€ç«¯                         æ¥æ”¶ç«¯
  â”‚                              â”‚
  â”œâ”€â”€[4å­—èŠ‚é•¿åº¦ + JSONä¿¡æ¯]â”€â”€â”€â”€â”€â†’â”‚
  â”‚                              â”‚
  â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€[READY]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                              â”‚
  â”œâ”€â”€[æ–‡ä»¶æ•°æ®åˆ†å—ä¼ è¾“]â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚
  â”‚                              â”‚
  â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€[ACK]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                              â”‚
```

---

### 4. ui/main_window.py - ä¸»çª—å£

**åŠŸèƒ½**: Qt ä¸»çª—å£ï¼Œä¸‰æ å¸ƒå±€

**å¸ƒå±€**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“¥ æ¥æ”¶åŒº  â”‚  ğŸ–¥ï¸ è®¾å¤‡åˆ—è¡¨  â”‚  ğŸ“¤ å‘é€åŒº  â”‚
â”‚            â”‚               â”‚            â”‚
â”‚  å†å²è®°å½•   â”‚   åœ¨çº¿è®¾å¤‡     â”‚   æ–‡å­—è¾“å…¥  â”‚
â”‚            â”‚               â”‚            â”‚
â”‚  æ‰“å¼€æ–‡ä»¶å¤¹ â”‚   åˆ·æ–°æŒ‰é’®     â”‚   é€‰æ‹©æ–‡ä»¶  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¿¡å·æœºåˆ¶**:
- `send_text_requested(ip, text)` - å‘é€æ–‡å­—è¯·æ±‚
- `send_file_requested(ip, path)` - å‘é€æ–‡ä»¶è¯·æ±‚

**ç‰¹æ€§**:
- æ‹–æ”¾æ”¯æŒ (æ–‡ä»¶/æ–‡å­—)
- ç³»ç»Ÿæ‰˜ç›˜å›¾æ ‡
- æ‰˜ç›˜é€šçŸ¥

---

### 5. ui/send_panel.py - æ‚¬æµ®å‘é€é¢æ¿

**åŠŸèƒ½**: å¯æ‚¬æµ®çš„å‘é€è®¾å¤‡é€‰æ‹©é¢æ¿

**ç‰¹æ€§**:
- æ— è¾¹æ¡†çª—å£
- åŠé€æ˜èƒŒæ™¯
- è®¾å¤‡æŒ‰é’®åŠ¨æ€ç”Ÿæˆ

---

### 6. ui/receive_bubble.py - æ¥æ”¶æ°”æ³¡

**åŠŸèƒ½**: å±å¹•å·¦ä¾§å¼¹å‡ºçš„é€šçŸ¥æ°”æ³¡

**BubbleManager ç‰¹æ€§**:
- å¤šæ°”æ³¡ä½ç½®ç®¡ç†
- è‡ªåŠ¨æ’åˆ—åŠ¨ç”»
- é¼ æ ‡æ‚¬åœæš‚åœè‡ªåŠ¨å…³é—­

---

### 7. utils/clipboard.py - å‰ªè´´æ¿ç®¡ç†

**åŠŸèƒ½**: QTimer è½®è¯¢ç›‘æ§å‰ªè´´æ¿å˜åŒ–

**å®ç°**: 
- 500ms å®šæ—¶æ£€æŸ¥
- å‘å‡º `clipboard_changed` ä¿¡å·

---

### 8. main.py - ä¸»ç¨‹åº

**åŠŸèƒ½**: æ•´åˆæ‰€æœ‰æ¨¡å—ï¼Œç®¡ç†åº”ç”¨ç”Ÿå‘½å‘¨æœŸ

**EasyConnectApp æ¶æ„**:
```
EasyConnectApp
â”œâ”€â”€ ç½‘ç»œç»„ä»¶
â”‚   â”œâ”€â”€ DeviceDiscovery  (è®¾å¤‡å‘ç°)
â”‚   â”œâ”€â”€ FileTransfer     (å‘é€å™¨)
â”‚   â””â”€â”€ TransferServer   (æ¥æ”¶æœåŠ¡å™¨)
â”œâ”€â”€ UI ç»„ä»¶
â”‚   â”œâ”€â”€ MainWindow       (ä¸»çª—å£)
â”‚   â”œâ”€â”€ SendPanel        (å‘é€é¢æ¿)
â”‚   â””â”€â”€ BubbleManager    (æ°”æ³¡ç®¡ç†)
â””â”€â”€ ClipboardManager     (å‰ªè´´æ¿ç›‘æ§)
```

**ä¿¡å·æµ**:
```
ç½‘ç»œå›è°ƒ â†’ Qt ä¿¡å· â†’ ä¸»çº¿ç¨‹ UI æ›´æ–°
```

---

## Android Kotlin ç‰ˆæœ¬

### é¡¹ç›®ç»“æ„

```
android-kotlin/app/src/main/java/com/easyconnect/
â”œâ”€â”€ Config.kt             # é…ç½®
â”œâ”€â”€ MainActivity.kt       # ä¸»ç•Œé¢
â”œâ”€â”€ model/
â”‚   â”œâ”€â”€ Device.kt         # è®¾å¤‡æ•°æ®ç±»
â”‚   â””â”€â”€ TransferMessage.kt# ä¼ è¾“æ¶ˆæ¯
â”œâ”€â”€ network/
â”‚   â”œâ”€â”€ DeviceDiscovery.kt# NSD è®¾å¤‡å‘ç°
â”‚   â”œâ”€â”€ TransferClient.kt # å‘é€å®¢æˆ·ç«¯
â”‚   â””â”€â”€ TransferServer.kt # æ¥æ”¶æœåŠ¡å™¨
â”œâ”€â”€ service/
â”‚   â””â”€â”€ TransferService.kt# å‰å°æœåŠ¡
â””â”€â”€ ui/
    â””â”€â”€ DeviceAdapter.kt  # è®¾å¤‡åˆ—è¡¨é€‚é…å™¨
```

### æ ¸å¿ƒå®ç°

#### DeviceDiscovery.kt

ä½¿ç”¨ Android NSD (Network Service Discovery) API:
```kotlin
nsdManager.registerService(serviceInfo, PROTOCOL_DNS_SD, listener)
nsdManager.discoverServices(SERVICE_TYPE, PROTOCOL_DNS_SD, listener)
```

#### TransferClient.kt / TransferServer.kt

- ä½¿ç”¨ Kotlin Coroutines å¼‚æ­¥å¤„ç†
- ä¸æ¡Œé¢ç‰ˆåè®®å®Œå…¨å…¼å®¹
- DataInputStream/DataOutputStream å¤„ç†æ¶ˆæ¯

#### TransferService.kt

- å‰å°æœåŠ¡ä¿æŒåå°è¿è¡Œ
- é€šçŸ¥æ˜¾ç¤ºè¿è¡ŒçŠ¶æ€

---

## åè®®å…¼å®¹æ€§

æ¡Œé¢ç‰ˆå’Œ Android ç‰ˆä½¿ç”¨ç›¸åŒçš„ç½‘ç»œåè®®ï¼š

| ç»„ä»¶ | æ¡Œé¢ç‰ˆ (Python) | Android (Kotlin) |
|------|----------------|------------------|
| æœåŠ¡å‘ç° | zeroconf | Android NSD |
| æœåŠ¡ç±»å‹ | `_easyconnect._tcp.local.` | `_easyconnect._tcp.` |
| ä¼ è¾“ç«¯å£ | 52525 | 52525 |
| æ¶ˆæ¯æ ¼å¼ | 4å­—èŠ‚å¤´ + JSON | 4å­—èŠ‚å¤´ + JSON |

---

## æ‰©å±•å»ºè®®

1. **åŠ å¯†ä¼ è¾“**: æ·»åŠ  TLS/SSL æ”¯æŒ
2. **æ–­ç‚¹ç»­ä¼ **: å¤§æ–‡ä»¶ä¼ è¾“ä¼˜åŒ–
3. **å†å²è®°å½•**: æœ¬åœ°æ•°æ®åº“å­˜å‚¨
4. **ç¾¤å‘åŠŸèƒ½**: å¤šè®¾å¤‡åŒæ—¶å‘é€
